window.initOptions={skin:"oxide",content_css:"default"},window.annotationInstances=null,window.labeltargetInstances=null,window.labelTypeVar=null;const clearAnnotationTippys=function(){window.annotationInstances&&window.annotationInstances.forEach(t=>t.destroy()),window.annotationInstances=null},setAnnotationTippys=function(){const t=document.querySelector("iframe").contentDocument;window.annotationInstances=tippy(t.querySelectorAll(".annotation_class"),{arrow:!1,placement:"right",offset:[40,10],theme:"light-border"})},clearLabeltargetTippys=function(){window.labeltargetInstances&&window.labeltargetInstances.forEach(t=>t.destroy()),window.labeltargetInstances=null},setLabeltargetTippys=function(){const t=document.querySelector("iframe").contentDocument;window.labeltargetInstances=tippy(t.querySelectorAll(".labeltarget_class"),{arrow:!1,placement:"right",offset:[40,10],theme:"light-border"})};window.destroyFunction=function(){const t=window.bridgeObj;clearAnnotationTippys(),clearLabeltargetTippys(),tinymce.activeEditor&&tinymce.activeEditor.destroy(),t.setObjs(null),t.setInterfaceContent("")},window.initFunction=function(t){window.destroyFunction(),tinymce.init({selector:"#TinyMCEInstance",branding:!1,menubar:!1,resize:!1,height:"100vh",skin:window.initOptions.skin,content_css:[window.initOptions.content_css],plugins:["help","code","lists","advlist","table","searchreplace","wordcount","hr"],custom_elements:"~annotation",valid_children:"-annotation[annotation|a],-a[annotation|a]",formats:{annotation:{inline:"annotation",attributes:{class:"annotation_class","data-tippy-content":"%value"},styles:{"background-color":"#FFFF00"},exact:!0,merge_siblings:!1},labeltarget:{inline:"a",attributes:{class:"labeltarget_class","data-tippy-content":"%value",name:"%value",type:"%value2"},styles:{"background-color":"#FF8C00"},exact:!0,merge_siblings:!1},labelref:{inline:"a",attributes:{class:"labelref_class",href:"%value"},styles:{"background-color":"#7FFFD4"},exact:!0,merge_siblings:!1}},toolbar:"\n            undo redo |\n            styleselect |\n            fontsizeselectgroup hr addAnnotationButton labelgroup |\n            bold italic underline strikethrough |\n            indentgroup aligngroup listgroup tablegroup |\n            searchreplace code wordcount help |\n        ",toolbar_groups:{fontsizeselectgroup:{icon:"change-case",tooltip:"Font size",items:"fontsizeselect"},labelgroup:{icon:"bookmark",tooltip:"Label",items:"addLabeltargetButton addLabelrefButton"},indentgroup:{icon:"indent",tooltip:"Indentation",items:"indent outdent"},aligngroup:{icon:"align-left",tooltip:"Alignment",items:"alignleft aligncenter alignright alignjustify"},listgroup:{icon:"unordered-list",tooltip:"Lists",items:"bullist numlist"},tablegroup:{icon:"table",tooltip:"Tables",items:"\n                    table tabledelete |\n                    tableprops tablerowprops tablecellprops |\n                    tableinsertrowbefore tableinsertrowafter tabledeleterow |\n                    tableinsertcolbefore tableinsertcolafter tabledeletecol |\n                "}},help_tabs:["shortcuts",{name:"annotations_tab",title:"Annotations",items:[{type:"htmlpanel",html:'\n                            <p>Selections may be annotated with a short text. The <span style="background-color: #FFFF00">annotation</span> will then be displayed when the user hovers over the affected selection.</p>\n                            <p>Deletion and editing of <span style="background-color: #FFFF00">annotations</span> is done through the context form triggered by moving the caret into their range.</p>\n                        '}]},{name:"labels_tab",title:"Labels",items:[{type:"htmlpanel",html:'\n                            <p>Within a note, selections may be designated label <span style="background-color: #FF8C00">targets</span> and label <span style="background-color: #7FFFD4">references</span>. Label <span style="background-color: #7FFFD4">references</span> point to label <span style="background-color: #FF8C00">targets</span>.</p>\n                            <p>Note that <span style="background-color: #7FFFD4">references</span> are not allowed to point to <span style="background-color: #FF8C00">targets</span> that do not exist. <span style="background-color: ##FF8C00">Target</span> uniqueness is enforced by the editor.</p>\n                            <p>Label <span style="background-color: #FF8C00">targets</span> are given a type, then a name by the user on creation through two successive context forms. <span style="background-color: #7FFFD4">references</span> are pointed to <span style="background-color: #FF8C00">targets</span> using names.</p>\n                            <p>To see the name of a <span style="background-color: ##FF8C00">target</span>, hover over its selection.</p>\n                            <p>There is a tab in the sidebar which allows users to aggregate labels within a note by type.</p>\n                            <p>Deleting a <span style="background-color: ##FF8C00">target</span> will delete all <span style="background-color: #7FFFD4">references</span> pointing to it. Deleting a <span style="background-color: #7FFFD4">reference</span> will not affect the <span style="background-color: ##FF8C00">target</span>.</p>\n                            <p>Deletion and editing of labels is done through the context form triggered by moving the caret into their range.</p>\n                        '}]}],setup:function(e){const n=window.bridgeObj,o=function(t){e.selection.getContent()&&e.fire("contexttoolbar-show",{toolbarKey:t})},a=function(t,e){return!!t&&t.className===e},i=function(t,e){for(;t&&!a(t,e);)t=t.parentNode;return t};e.on("init",function(){e.setContent(t),n.setObjs(e),setAnnotationTippys(),setLabeltargetTippys()}),e.on("Change SetContent",function(t){n.setInterfaceContent(e.getContent())}),e.ui.registry.addButton("addAnnotationButton",{icon:"edit-block",tooltip:"Annotate",onAction:function(t){o("annotate-form")}}),e.ui.registry.addButton("addLabeltargetButton",{icon:"bookmark",tooltip:"Label target",onAction:function(t){o("labeltarget-form")}}),e.ui.registry.addButton("addLabelrefButton",{icon:"link",tooltip:"Label reference",onAction:function(t){o("labelref-form")}}),e.ui.registry.addContextForm("annotate-form",{label:"Annotate",initValue:function(){var t=i(e.selection.getNode(),"annotation_class");return t?t.getAttribute("data-tippy-content"):""},position:"selection",predicate:function(t){return!!i(t,"annotation_class")},commands:[{type:"contextformbutton",icon:"checkmark",tooltip:"Add annotation",primary:!0,onAction:function(t){var n=t.getValue();if(n){var o=i(e.selection.getNode(),"annotation_class");if(o)o.setAttribute("data-tippy-content",n);else{for(k in e.formatter.get())e.formatter.remove(k);e.formatter.apply("annotation",{value:n})}}e.fire("Change"),clearAnnotationTippys(),setAnnotationTippys(),t.hide()}},{type:"contextformbutton",icon:"close",tooltip:"Remove annotation",onAction:function(t){var n=i(e.selection.getNode(),"annotation_class");n&&(n.removeAttribute("data-tippy-content"),n.removeAttribute("style"),e.formatter.remove("annotation",null,n)),e.fire("Change"),clearAnnotationTippys(),setAnnotationTippys(),t.hide()}}]}),e.ui.registry.addContextForm("labeltarget-form",{label:"Label target",initValue:function(){return""},position:"selection",predicate:function(t){return!!i(t,"labeltarget_class")},commands:[{type:"contextformbutton",icon:"checkmark",tooltip:"Add target type",primary:!0,onSetup:function(t){var n=i(e.selection.getNode(),"labeltarget_class");t.setDisabled(!!n)},onAction:function(t){var n=t.getValue();n&&(window.labelTypeVar=n,e.fire("contexttoolbar-show",{toolbarKey:"labeltarget-form2"})),t.hide()}},{type:"contextformbutton",icon:"close",tooltip:"Remove target",onSetup:function(t){var n=i(e.selection.getNode(),"labeltarget_class");t.setDisabled(!n)},onAction:function(t){var n=i(e.selection.getNode(),"labeltarget_class");if(n){const t=n.getAttribute("name");n.removeAttribute("data-tippy-content"),n.removeAttribute("name"),n.removeAttribute("type"),n.removeAttribute("style"),e.formatter.remove("labeltarget",null,n),document.querySelector("iframe").contentDocument.querySelectorAll(`a[href="#${t}"]`).forEach(t=>e.formatter.remove("labelref",null,t))}e.fire("Change"),clearLabeltargetTippys(),setLabeltargetTippys(),t.hide()}}]}),e.ui.registry.addContextForm("labeltarget-form2",{label:"Label target",initValue:function(){return""},position:"selection",commands:[{type:"contextformbutton",icon:"checkmark",tooltip:"Add target name",primary:!0,onAction:function(t){var n=t.getValue();if(n){var o=i(e.selection.getNode(),"labeltarget_class");const t=document.querySelector("iframe").contentDocument;if(!o&&0==t.querySelectorAll(`a[name="${n}"]`).length){for(k in e.formatter.get())e.formatter.remove(k);e.formatter.apply("labeltarget",{value:n,value2:window.labelTypeVar})}}e.fire("Change"),clearLabeltargetTippys(),setLabeltargetTippys(),window.labelTypeVar=null,t.hide()}}]})}})};
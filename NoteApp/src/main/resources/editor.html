<!DOCTYPE html>
<html>
<head>
    <script src="tinymce/tinymce.min.js"></script>
    <script type="text/javascript">
        window.initOptions = {
            skin: "oxide",
            content_css: "default",
        };

        window.destroyFunction = function () {
            const bridge = window.bridgeObj;

            if (tinymce.activeEditor) {
                tinymce.activeEditor.destroy();
            }
            bridge.setObjs(null);
            bridge.setInterfaceContent("");
        };

        window.initFunction = function (initContent) {
            window.destroyFunction();

            tinymce.init({
                selector: "#TinyMCEInstance",
                branding: false,
                menubar: false,
                resize: false,
                height: "100vh",

                skin: window.initOptions.skin,
                content_css: window.initOptions.content_css,

                plugins: ["lists"],

                toolbar: `
                        undo redo |
                        styleselect |
                        bold italic underline strikethrough |
                        alignleft aligncenter alignright alignjustify |
                        bullist numlist outdent indent |
                        addAnnotateButton removeAnnotateButton labelButton
                    `,

                setup: function (ed) {
                    const bridge = window.bridgeObj;
                    const openAnnotateForm = function () {
                        if (ed.selection.getContent()) {
                            ed.fire("contexttoolbar-show", {
                                toolbarKey: "annotate-form",
                            });
                        }
                    };

                    ed.on("init", function () {
                        // triggers SetContent event and updates interface content
                        ed.setContent(initContent);
                        bridge.setObjs(ed);
                    });

                    ed.on("Change SetContent", function (e) {
                        bridge.setInterfaceContent(ed.getContent());
                    });

                    ed.ui.registry.addButton("addAnnotateButton", {
                        icon: "edit-block",
                        tooltip: "Add annotation",
                        onAction: function (_) {
                            openAnnotateForm();
                        },
                    });

                    ed.ui.registry.addButton("removeAnnotateButton", {
                        icon: "cut",
                        tooltip: "Remove annotation",
                        onAction: function (_) {
                            bridge.callModel("removeAnnotation", "");
                        },
                    });

                    ed.ui.registry.addButton("labelButton", {
                        icon: "character-count",
                        tooltip: "Label",
                        onAction: function (_) {
                            bridge.callModel("label", "");
                        },
                    });

                    ed.ui.registry.addContextForm("annotate-form", {
                        label: "Annotate",
                        initValue: function () {
                            return "";
                        },
                        commands: [
                            {
                                type: "contextformbutton",
                                icon: "checkmark",
                                tooltip: "Submit",
                                primary: true,
                                onAction: function (formApi) {
                                    var value = formApi.getValue();
                                    bridge.callModel("addAnnotation", value);
                                    formApi.hide();
                                },
                            },
                        ],
                    });
                },
            });
        };
    </script>
</head>
<body>
<form method="post">
    <textarea id="TinyMCEInstance"></textarea>
</form>
</body>
</html>

<style>
body {
    margin: 0px;
    height: 100vh;
}
</style>